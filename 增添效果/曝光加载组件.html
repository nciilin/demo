

<!DOCTYPE html>
<html>
<head>
<script src="http://kejian.jirengu.com/static/js/jquery-1.11.1.min.js"></script>

  <meta charset="utf-8">
  <title>图片懒加载-曝光加载</title>
  <style>
    ul,li{
      list-style:none;
    }
    .container{
      max-width: 800px;
      margin: 0 auto;
    }
    .container:after{
    	content: '';
    	display: block;
    	clear: both;
    }
    .container li{
      float: left;
      margin: 10px 10px;
    }
    .container li img{
      width: 380px;
      height: 380px;
    }
    p{
      float: left;
    }
  </style>
 
</head>
<body>
<ul class="container">
  <li><a href="#"><img src="http://upload.ouliu.net/i/20171117211828es6la.jpeg" data-src="http://upload.ouliu.net/1.jpg" /></a></li>
  <li><a href="#"><img src="http://upload.ouliu.net/i/201711172118500ojh6.jpeg" data-src="http://upload.ouliu.net/2.jpg" /></a></li>
  <li><a href="#"><img src="http://upload.ouliu.net/i/20171117211905gv8ja.jpeg" data-src="http://upload.ouliu.net/3.jpg" /></a></li>
  <li><a href="#"><img src="http://upload.ouliu.net/i/20171117211924gyb0y.jpeg" data-src="http://upload.ouliu.net/4.jpg" /></a></li>
  <li><a href="#"><img src="http://upload.ouliu.net/i/20171117211937iym35.jpeg" data-src="http://upload.ouliu.net/5.jpg" /></a></li>
  <li><a href="#"><img src="http://upload.ouliu.net/i/2017111721202614swo.jpeg" data-src="http://upload.ouliu.net/6.jpg" /></a></li>
  <li><a href="#"><img src="http://upload.ouliu.net/i/20171117212105ex543.jpeg" data-src="http://upload.ouliu.net/7.jpg" /></a></li>
  <li><a href="#"><img src="http://upload.ouliu.net/i/20171117212127jyjdm.jpeg" data-src="http://upload.ouliu.net/8.jpg" /></a></li>
  <li><a href="#"><img src="http://upload.ouliu.net/i/201711172121431suwu.jpeg" data-src="http://upload.ouliu.net/9.jpg" /></a></li>
  <li><a href="#"><img src="http://upload.ouliu.net/i/20171117212203ca0fr.jpeg" data-src="http://upload.ouliu.net/10.jpg" /></a></li>
  <li><a href="#"><img src="http://upload.ouliu.net/i/201711172122213oszd.jpeg" data-src="http://upload.ouliu.net/11.jpg" /></a></li>
  <li><a href="#"><img src="http://upload.ouliu.net/i/20171117212246rehjg.jpeg" data-src="http://upload.ouliu.net/12.jpg" /></a></li>
  <li><a href="#"><img src="http://upload.ouliu.net/i/20171117212305dyx2w.jpeg" data-src="http://upload.ouliu.net/13.jpg" /></a></li>
  <li><a href="#"><img src="http://upload.ouliu.net/i/201711172123186518c.jpeg" data-src="http://upload.ouliu.net/14.jpg" /></a></li>
  <li><a href="#"><img src="http://upload.ouliu.net/i/20171117212336t3fly.jpeg" data-src="http://upload.ouliu.net/15.jpg" /></a></li>
  <p id="hello">hello</p>
  <p id="world">world</p>

</ul>

<script>


function Exposure($target, callback){
  this.$target = $target;
  this.callback = callback;
  this.bind();
  this.check();
}

// Exposure.prototype.init = function(){

// }

Exposure.prototype.bind = function(){
  var _this = this;
  $(window).on('scroll', function(){
    _this.check();
  })
}

Exposure.prototype.check = function(){
    if(this.isShow(this.$target)){
      this.callback(this.$target);
    }
}

Exposure.prototype.isShow = function(){
  var windowHeight = $(window).height(),
      scrollTop = $(window).scrollTop(),
      offsetTop = this.$target.offset().top,
      nodeHeight = this.$target.height();
  if(windowHeight + scrollTop > offsetTop && scrollTop < offsetTop + nodeHeight){
    return true;
  }else{
    return false;
  }
}

function showImg($img){
    var imgUrl = $img.attr('data-src');
    $img.attr('src', imgUrl);
}

// 当窗口滚动看见ID元素hello时，执行
new Exposure($('#hello'), function($node){
    $node.text( $node.text() + $node.text());
})
// 同上
new Exposure($('#world'), function(){
  $('#world').text( 'hello ' + $('#world').text() );
})

$('.container img').each(function(idx, img){
  new Exposure($(img), function($img){
      showImg($img)
  })
})





// 封装曝光加载组件
/*
var Lazy = (function(){
  function Exposure($target, callback){
  this.$target = $target;
  this.callback = callback;
  this.bind();
  this.check();
  }

  Exposure.prototype.bind = function(){
    var _this = this;
    $(window).on('scroll', function(){
      _this.check();
    })
  }

  Exposure.prototype.check = function(){
      if(this.isShow(this.$target)){
        this.callback(this.$target);
      }
  }
  Exposure.prototype.isShow = function(){
    var windowHeight = $(window).height(),
        scrollTop = $(window).scrollTop(),
        offsetTop = this.$target.offset().top,
        nodeHeight = this.$target.height();
    if(windowHeight + scrollTop > offsetTop && scrollTop < offsetTop + nodeHeight){
      return true;
    }else{
      return false;
    }
  }

  function showImg($img){
    var imgUrl = $img.attr('data-src');
    $img.attr('src', imgUrl);
  }

  return {
    init: function($targets, callback){
      $targets.each(function(idx, target){
        new Exposure($(target), callback);
      })
    }
  }
})();

Lazy.init($('#hello'), function($node){
  $node.text( $node.text() + '123');
});
Lazy.init($('#world'), function($node){
  $node.text( $node.text() + '456');
});
Lazy.init($('.container img'), function($node){
  showImg($node);
});


*/




</script>
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
</body>
</html>
